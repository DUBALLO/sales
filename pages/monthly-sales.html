<!-- 기존 스크립트 부분을 이 코드로 교체하세요 -->
    <script src="../assets/js/common.js"></script>
    <script src="../assets/js/monthly-sales.js"></script>
    
    <script>
        // 페이지 로드시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 로드 완료, 데이터 로딩 시작...');
            
            // 실제 CSV 데이터 로드 시도
            loadSampleData(); // 이 함수가 내부적으로 loadSalesData()를 호출
            
            // 이벤트 리스너 설정
            document.getElementById('searchBtn').addEventListener('click', function() {
                console.log('조회 버튼 클릭');
                MonthlySales.generateReport();
            });
            
            document.getElementById('uploadBtn').addEventListener('click', toggleUploadPanel);
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('closeDetailBtn').addEventListener('click', hideDetailSection);
            
            // 새로고침 버튼 추가 (데이터 다시 로드)
            const refreshBtn = document.createElement('button');
            refreshBtn.className = 'btn btn-secondary ml-2';
            refreshBtn.innerHTML = `
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                데이터 새로고침
            `;
            refreshBtn.addEventListener('click', function() {
                console.log('데이터 새로고침');
                CommonUtils.showAlert('데이터를 다시 불러오는 중...', 'info', 1000);
                MonthlySales.loadSalesData();
            });
            
            // 검색 버튼 옆에 새로고침 버튼 추가
            const searchBtn = document.getElementById('searchBtn');
            searchBtn.parentNode.insertBefore(refreshBtn, searchBtn.nextSibling);
        });
        
        // 업로드 패널 토글
        function toggleUploadPanel() {
            const panel = document.getElementById('uploadPanel');
            panel.classList.toggle('hidden');
        }
        
        // 파일 업로드 처리
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                if (!file.name.endsWith('.csv') && !file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                    CommonUtils.showAlert('CSV 또는 Excel 파일만 업로드 가능합니다.', 'warning');
                    return;
                }
                
                CommonUtils.showAlert(`파일 "${file.name}"을 처리 중입니다...`, 'info');
                
                // 파일 업로드 처리 (추후 구현)
                setTimeout(() => {
                    CommonUtils.showAlert('파일 처리 기능은 곧 추가될 예정입니다.', 'warning');
                }, 1000);
            }
        }
        
        // 데이터 내보내기
        function exportData() {
            try {
                const table = document.getElementById('monthlyTable');
                const filename = `월별매출현황_${new Date().toISOString().slice(0,10)}.csv`;
                CommonUtils.exportTableToCSV(table, filename);
                CommonUtils.showAlert('데이터가 성공적으로 내보내졌습니다.', 'success');
            } catch (error) {
                console.error('내보내기 오류:', error);
                CommonUtils.showAlert('데이터 내보내기 중 오류가 발생했습니다.', 'error');
            }
        }
        
        // 상세내역 섹션 숨기기
        function hideDetailSection() {
            document.getElementById('detailSection').classList.add('hidden');
        }
        
        // 전역 에러 핸들러
        window.addEventListener('error', function(e) {
            console.error('전역 에러:', e.error);
            CommonUtils.showAlert('예상치 못한 오류가 발생했습니다.', 'error');
        });
        
        // URL 해시 변경시 처리 (나중에 추가할 수 있음)
        window.addEventListener('hashchange', function() {
            console.log('URL 해시 변경:', window.location.hash);
        });
    </script>
